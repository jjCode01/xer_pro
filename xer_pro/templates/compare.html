{% extends "_layout.html" %}
{% block nav_content %}
    <a class="nav-link" aria-current="page" href="{{ url_for('dashboard') }}"><i class="bi bi-speedometer2 me-1"></i>Dashboard</a>
    <a class="nav-link active" href="#">Comparison</a>
    <a class="nav-link" aria-current="page" href="{{ url_for('warnings') }}">Warnings</a>
{% endblock %}
{% block main_content %}
<section class="bg-light text-dark border-bottom p-1">
    <div class="container-fluid">
        <h5 class="mt-1">{{ schedules.current.name }}</h5>
    </div>
</section>

<section class="py-3 px-md-4 bg-white">
    <div class="container-lg">
        <div class="row">
            <div class="col-sm-6 col-md-4">
                <table class="table caption-top w-100">
                    <caption>Activity Changes</caption>
                    <tbody>
                        <tr>
                            <td>Added Activities:</td>
                            <td class="text-end">{{ task_changes.added|length }}</td>
                        </tr>
                        <tr>
                            <td>Deleted Activities:</td>
                            <td class="text-end">{{ task_changes.deleted|length }}</td>
                        </tr>
                        <tr>
                            <td>Revised Names:</td>
                            <td class="text-end">{{ task_changes.name|length }}</td>
                        </tr>
                        <tr>
                            <td>Revised Durations:</td>
                            <td class="text-end">{{ (task_changes.orig_duration|length + task_changes.rem_duration|length)|formatnumber }}</td>
                        </tr>
                        <tr>
                            <td>Revised Actual Dates:</td>
                            <td class="text-end">{{ (task_changes.act_start|length + task_changes.act_finish|length)|formatnumber }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="col-sm-6 col-md-4">
                <table class="table caption-top w-100">
                    <caption>Relationship Changes</caption>
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>

<section class="py-3 px-md-4 bg-white">
    <div class="container-lg">

        {% if task_changes.added|length %}
        <!-- Added tasks -->
        <div class="table-responsive-md mb-5">
            <table class="table table-striped table-hover caption-top">
                <caption class="h5 text-dark m-0">Added Activities: {{ task_changes.added|length|formatnumber }}</caption>
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col" class="text-start">ID</th>
                        <th scope="col" class="text-start">Name</th>
                        <th scope="col" class="text-start">Cal</th>
                        <th scope="col" class="text-center">Orig Dur</th>
                        <th scope="col" class="text-center">Start</th>
                        <th scope="col" class="text-center">Finish</th>
                        <th scope="col" class="text-center">TF</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in task_changes.added %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td class="text-start text-nowrap">{{ task.activity_id }}</td>
                        <td class="text-start">{{ task.name }}</td>
                        <td class="text-start">{{ task.calendar.name }}</td>
                        <td class="text-center">{{ task.original_duration|formatnumber }}</td>
                        <td class="text-center text-nowrap">{{ task.start|formatdate }}</td>
                        <td class="text-center text-nowrap">{{ task.finish|formatdate }}</td>
                        <td class="text-center">{{ task.total_float|formatnumber }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- Deleted tasks -->
        {% if task_changes.deleted|length %}
        <div class="table-responsive-md  mb-5">
            <table class="table table-striped table-hover caption-top">
                <caption class="h5 text-dark m-0">Deleted Activities: {{ task_changes.deleted|length|formatnumber }}</caption>
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col" class="text-start">ID</th>
                        <th scope="col" class="text-start">Name</th>
                        <th scope="col" class="text-start">Cal</th>
                        <th scope="col" class="text-center">Orig Dur</th>
                        <th scope="col" class="text-center">Start</th>
                        <th scope="col" class="text-center">Finish</th>
                        <th scope="col" class="text-center">TF</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in task_changes.deleted %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td class="text-start text-nowrap">{{ task.activity_id }}</td>
                        <td class="text-start">{{ task.name }}</td>
                        <td class="text-start">{{ task.calendar.name }}</td>
                        <td class="text-center">{{ task.original_duration|formatnumber }}</td>
                        <td class="text-center text-nowrap">{{ task.start|formatdate }}</td>
                        <td class="text-center text-nowrap">{{ task.finish|formatdate }}</td>
                        <td class="text-center">{{ task.total_float|formatnumber }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- Name Changes -->
        {% if task_changes.name %}
        <div class="table-responsive-md  mb-5">
            <table class="table table-striped table-hover caption-top">
                <caption class="h5 text-dark m-0">Activity Name Changes: {{ task_changes.name|length|formatnumber }}</caption>
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">ID</th>
                        <th scope="col">New Name</th>
                        <th scope="col">Old Name</th>
                        <th scope="col" class="text-center">Match</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in task_changes.name %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td class="text-nowrap">{{ task[0].activity_id }}</td>
                        <td>{{ task[0].name }}</td>
                        <td>{{ task[1].name }}</td>
                        {% if 60 <= task[2] < 80 %}
                            <td class="text-center bg-warning">{{ task[2] }}%</td>
                        {% elif task[2] < 60 %}
                            <td class="text-center bg-danger text-light">{{ task[2] }}%</td>
                        {% else %}
                            <td class="text-center">{{ task[2] }}%</td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- Original Duration Changes -->
        {% if task_changes.orig_duration %}
        <div class="table-responsive-md  mb-5">
            <table class="table table-striped table-hover caption-top">
                <caption class="h5 text-dark m-0">Original Duration Changes: {{ task_changes.orig_duration|length|formatnumber }}</caption>
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col" class="text-start">ID</th>
                        <th scope="col" class="text-start">Name</th>
                        <th scope="col" class="text-center">New Dur</th>
                        <th scope="col" class="text-center">Old Dur</th>
                        <th scope="col" class="text-center">Diff</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in task_changes.orig_duration %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td class="text-start text-nowrap">{{ task[0].activity_id }}</td>
                        <td class="text-start">{{ task[0].name }}</td>
                        <td class="text-center">{{ task[0].original_duration|formatnumber }}</td>
                        <td class="text-center">{{ task[1].original_duration|formatnumber }}</td>
                        {% with %}
                        {% set diff = task[0].original_duration - task[1].original_duration %}
                        {% if diff < 0 %}
                            {% set color = 'text-danger' %}
                        {% endif %}
                        <td class="text-center {{ color }}">{{ diff|formatvariance }}</td>
                        {% endwith %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- Remaining Duration Changes -->
        {% if task_changes.rem_duration %}
        <div class="table-responsive-md  mb-5">
            <table class="table table-striped table-hover caption-top">
                <caption class="h5 text-dark m-0">Remaining Duration Changes: {{ task_changes.rem_duration|length|formatnumber }}</caption>
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col" class="text-start">ID</th>
                        <th scope="col" class="text-start">Name</th>
                        <th scope="col" class="text-center">New Dur</th>
                        <th scope="col" class="text-center">Old Dur</th>
                        <th scope="col" class="text-center">Diff</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in task_changes.rem_duration %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td class="text-start text-nowrap">{{ task[0].activity_id }}</td>
                        <td class="text-start">{{ task[0].name }}</td>
                        <td class="text-center">{{ task[0].remaining_duration|formatnumber }}</td>
                        <td class="text-center">{{ task[1].remaining_duration|formatnumber }}</td>
                        {% with %}
                        {% set diff = task[0].remaining_duration - task[1].remaining_duration %}
                        {% if diff < 0 %}
                            {% set color = 'text-danger' %}
                        {% endif %}
                        <td class="text-center {{ color }}">{{ (task[0].remaining_duration - task[1].remaining_duration)|formatvariance }}</td>
                        {% endwith %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- Actual Start Changes -->
        {% if task_changes.act_start %}
        <div class="table-responsive-md  mb-5">
            <table class="table table-striped table-hover caption-top">
                <caption class="h5 text-dark m-0">Actual Start Changes: {{ task_changes.act_start|length|formatnumber }}</caption>
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col" class="text-start">ID</th>
                        <th scope="col" class="text-start">Name</th>
                        <th scope="col" class="text-center">New Start</th>
                        <th scope="col" class="text-center">Old Start</th>
                        <th scope="col" class="text-center">Diff</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in task_changes.act_start %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td class="text-start text-nowrap">{{ task[0].activity_id }}</td>
                        <td class="text-start">{{ task[0].name }}</td>
                        <td class="text-center">{{ task[0].act_start_date|formatdate }}</td>
                        <td class="text-center">{{ task[1].act_start_date|formatdate }}</td>
                        {% with %}
                        {% if not task[0].act_start_date is none and not task[1].act_start_date is none %}
                            {% set diff = (task[0].act_start_date - task[1].act_start_date).days %}
                            {% if diff < 0 %}
                                {% set color = 'text-danger' %}
                            {% endif %}
                        {% else %}
                            {% set diff = '-' %}
                        {% endif %}
                        <td class="text-center {{ color }}">{{ diff|formatvariance }}</td>
                        {% endwith %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- Actual Start Changes -->
        {% if task_changes.act_finish %}
        <div class="table-responsive-md  mb-5">
            <table class="table table-striped table-hover caption-top">
                <caption class="h5 text-dark m-0">Actual Finish Changes: {{ task_changes.act_finish|length|formatnumber }}</caption>
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col" class="text-start">ID</th>
                        <th scope="col" class="text-start">Name</th>
                        <th scope="col" class="text-center">New Finish</th>
                        <th scope="col" class="text-center">Old Finish</th>
                        <th scope="col" class="text-center">Diff</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in task_changes.act_finish %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td class="text-start text-nowrap">{{ task[0].activity_id }}</td>
                        <td class="text-start">{{ task[0].name }}</td>
                        <td class="text-center">{{ task[0].act_end_date|formatdate }}</td>
                        <td class="text-center">{{ task[1].act_end_date|formatdate }}</td>
                        {% with %}
                        {% if not task[0].act_end_date is none and not task[1].act_end_date is none %}
                            {% set diff = (task[0].act_end_date - task[1].act_end_date).days %}
                            {% if diff < 0 %}
                                {% set color = 'text-danger' %}
                            {% endif %}
                        {% else %}
                            {% set diff = '-' %}
                        {% endif %}
                        <td class="text-center {{ color }}">{{ diff|formatvariance }}</td>
                        {% endwith %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}